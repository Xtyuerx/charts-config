# 图表系统伪代码说明

## 1. 数据结构定义

```typescript
// 数据源类型定义
type OriginData = {
  dataSource: ChartDataItem[]      // 图表数据
  dataSourceFields: OptionFields[] // 数据源选项
  xAxisFields: OptionFields[]      // 横轴字段选项
  yAxisFields: OptionFields[]      // 纵轴字段选项
}

// 字段选项类型
type OptionFields = {
  text: string    // 显示文本
  label: string   // 字段标签
  key: string     // 字段键
  value: string   // 字段值
}
```

## 2. App.vue 主要逻辑

### 2.1 数据初始化
```typescript
// 伪代码：应用初始化
function initializeApp() {
  // 1. 创建响应式数据
  originData = ref<OriginData[]>([])           // 原始数据数组
  dataSource = ref([])                         // 当前图表数据
  dataSourceFields = ref<OptionFields[]>([])   // 数据源字段选项
  xAxisFields = ref<OptionFields[]>([])        // 横轴字段选项
  yAxisFields = ref<OptionFields[]>([])        // 纵轴字段选项
  
  // 2. 图表管理相关
  chartConfigs = ref<ChartConfig[]>([])        // 图表配置数组
  chartInstances = ref<Map>()                  // 图表实例映射
  
  // 3. UI 状态
  dialogVisible = ref(false)                   // 对话框显示状态
  currentChartIndex = ref(0)                   // 当前编辑的图表索引
}
```

### 2.2 数据源获取
```typescript
// 伪代码：获取数据源
async function getDataSource() {
  try {
    // 1. 调用接口获取数据
    const response = await 请求接口<OriginData[]>()
    
    // 2. 更新原始数据
    originData.value = response
    
    // 3. 设置默认数据源（第一个）
    const firstSource = response[0]
    if (firstSource) {
      dataSource.value = firstSource.tableData
      
      // 4. 处理字段选项映射
      dataSourceFields.value = firstSource.axisSelectList.map(item => ({
        label: item.label,
        value: item.value
      }))
      
      // 5. 设置轴字段选项
      xAxisFields.value = firstSource.axisSelectList.horizontal
      yAxisFields.value = firstSource.axisSelectList.vertical
    }
  } catch (error) {
    console.error('获取数据源失败:', error)
  }
}
```

### 2.3 数据源切换
```typescript
// 伪代码：处理数据源变化
function handleDataSourceChange(selectedData: OptionFields) {
  // 1. 在原始数据中查找匹配的数据源
  const targetIndex = originData.value.findIndex(item => 
    item.dataSource.some(dataItem => dataItem.value === selectedData.value)
  )
  
  // 2. 如果找到匹配的数据源
  if (targetIndex !== -1) {
    const targetData = originData.value[targetIndex]
    
    // 3. 更新所有相关数据
    dataSource.value = targetData.dataSource           // 更新图表数据
    dataSourceFields.value = targetData.dataSourceFields // 更新数据源选项
    xAxisFields.value = targetData.xAxisFields         // 更新横轴选项
    yAxisFields.value = targetData.yAxisFields         // 更新纵轴选项
    
    // 4. 重新渲染所有图表
    renderAllCharts()
  }
}
```